name: DEV Environment Deployment 

on:
  push:
    branches: 
      - dev
      - development

env:
  # Docker Credentials
  DOCKER_USER: ${{ secrets.DOCKER_USER }}
  DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}

  # CI Registry
  CI_REGISTRY: ghcr.io/${{ github.repository }}
  CI_REGISTRY_IMAGE: ghcr.io/${{ github.repository }}

  # Application Info
  APPLICATION_NAME: yui
  APPLICATION_NAMESPACE: yui-dev
  APPLICATION_VERSION: 1.0.0-dev
  APPLICATION_PROFILE: 'dev'
  

jobs:
  push_to_registry:
    name: Push Docker image to AWS ECR
    runs-on: ubuntu-latest
    steps:
    - name: Configure AWS Credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_KEY }}
        aws-region: ap-southeast-1

    - name: Login to AWS ECR
      id: login-ecr
      uses: aws-actions/amazon-ecr-login@v1

    - name: Build, tag, and push image to AWS ECR
      env: 
        ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
        ECR_REPOSITORY: yui
        IMAGE_TAG: ${{ github.sha }}
      run:
        docker build -t $ECR_REGISTRY/ECR_REPOSITORY:$IMAGE_TAG .
        docker push $ECR_REGISTRY/ECR_REPOSITORY:$IMAGE_TAG

  # push_to_registry:
  #   name: Push Docker image to Docker Hub
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v3

  #     - name: Log in to Docker Hub
  #       run:  |
  #         docker login -u $DOCKER_USER -p $DOCKER_PASSWORD $CI_REGISTRY
      
  #     - name: Build Docker Image
  #       run: |
  #         docker build -t $CI_REGISTRY_IMAGE:$APPLICATION_VERSION .

  #     - name: Push Docker Image
  #       run: |
  #         docker push $CI_REGISTRY_IMAGE:$APPLICATION_VERSION
